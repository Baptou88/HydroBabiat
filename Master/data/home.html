<!DOCTYPE html>
<html lang="fr" data-bs-theme="light">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HydroBabiat</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" href="logo.png" type="image/x-icon" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/stock/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>

    <script src="/app.js" type="text/javascript"></script>
    <script src="/theme.js" type="text/javascript"></script>

    <link rel="stylesheet" href="style.css">
    <style>
        @import url("https://code.highcharts.com/css/highcharts.css");

        @media (prefers-color-scheme: dark) {
            :root {
                /* UI colors */
                --highcharts-background-color: var(--bs-body-bg);
            }
        }

        .highcharts-dark {
            /* UI colors */
            --highcharts-background-color: #212529;
        }
    </style>
</head>

<body>
    <header class="border-bottom">
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <a class="navbar-brand" href="/">
                    <img src="/icons/hydro-elec-512.svg" alt="Bootstrap" width="40" height="40" />
                    HydroBabiat
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="/">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link icon-link" href="programmateur"><i class="bi bi-calendar-event"></i>
                                Programmateur</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="fileSystem"><i class="bi bi-database"></i> FS</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link disabled">Disabled</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle icon-link" href="#" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-cpu"></i>Nodes
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#Etang">Etang</a></li>
                                <li><a class="dropdown-item" href="#Turbine">Turbine</a></li>
                                <li>
                                    <a class="dropdown-item" href="#NodeTest">Radiateurs</a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <button
                                class="btn btn-link nav-link py-2 px-0 px-lg-2 dropdown-toggle d-flex align-items-center"
                                id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown"
                                data-bs-display="static">
                                <div class="theme-icon-active">
                                    <i class="bi bi-circle-half"></i>
                                </div>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme"
                                style="--bs-dropdown-min-width: 8rem">
                                <li>
                                    <button type="button" class="dropdown-item d-flex align-items-center"
                                        data-bs-theme-value="light">
                                        <i class="bi bi-sun-fill"></i>
                                        Light
                                    </button>
                                </li>
                                <li>
                                    <button type="button" class="dropdown-item d-flex align-items-center active"
                                        data-bs-theme-value="dark">
                                        <i class="bi bi-moon-stars-fill"></i>
                                        Dark
                                    </button>
                                </li>
                                <li>
                                    <button type="button" class="dropdown-item d-flex align-items-center"
                                        data-bs-theme-value="auto">
                                        <i class="bi bi-circle-half"></i>
                                        Auto
                                    </button>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <form class="d-flex" role="search">
                        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" />
                        <button class="btn btn-outline-success" type="submit">
                            Search
                        </button>
                    </form>
                    <button class="btn btn-outline-warning" type="submit" onclick="logout()">
                        Logout %user%
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <div class="row mx-1 mt-2">
        <div class="col-4">
            <div class="card">
                <div class="card-header">
                    Modes
                    <div class="card-subtitle">%mode%</div>
                </div>

                <ul class="list-group" id="modes">
                    %modes%
                </ul>
            </div>
        </div>

        <div class="col-8">
            <div class="container border rounded" data-modee="0" x-data="{edit: false,value:0}">
                m0
                <div class="progress" role="progressbar" aria-label="Example with label" aria-valuenow="25"
                    aria-valuemin="0" aria-valuemax="100">
                    <div class="progress-bar" :style="{width: $store.Turbine.positionVannetoString()}"
                        x-text="$store.Turbine.positionVannetoString()"></div>
                </div>
                <label for="PositionVanneTarget" class="form-label">Cible Vanne <span x-show="edit"
                        x-text="value"></span></label>
                <input type="range" class="form-range" id="PositionVanneTarget" value="%PositionVanneTarget%"
                    x-bind:value="$store.Turbine.positionVanneTarget" x-bind:input="edit = true; value= $el.value"
                    x-bind:change="edit = false" />
            </div>
            <div class="container border rounded" data-modee="1" x-data="{edited: false}">
                m1
                <div x-show="edited">
                    <button @click="edited = false" onclick="websocket.send('SavePref')">
                        Save Pref
                    </button>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">target vanne</span>
                    <input type="number" class="form-control param" name="bctarget" id="bc.target" value="%bc.target%"
                        data-param="bc.target" x-on:change="edited = true" />
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">min</span>
                    <input type="number" class="form-control param" name="bcmin" id="bc.min" value="%bc.min%"
                        data-param="bc.min" x-on:change="edited = true" />
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">max</span>
                    <input type="number" class="form-control param" name="bcmax" id="bc.max" value="%bc.max%"
                        data-param="bc.max" x-on:change="edited = true" />
                </div>
            </div>
            <div class="container border rounded" data-modee="2">
                m2
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">kp</span>
                    <input type="number" class="form-control param" name="pidcKp" id="pidcKp" value="%pidc.kp%"
                        data-param="pidc.kp" />
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">ki</span>
                    <input type="number" class="form-control" name="pidcKi" id="pidcKi" value="%pidc.ki%"
                        data-param="pidc.ki" />
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">kd</span>
                    <input type="number" class="form-control" name="pidcKd" id="pidcKd" value="%pidc.kd%"
                        data-param="pidc.kd" />
                </div>
                <div class="input-group mb-3">
                    <input type="button" class="btn param" value="a" />
                </div>
            </div>
            <div class="container border rounded my-3"
                x-data="{Notification: %Notification% ,NotificationGroup: %NotificationGroup% }">
                <div class="form-check form-switch">
                    <label class="form-check-label" for="Notification">Notification</label>
                    <input class="form-check-input" type="checkbox" id="Notification" x-bind:checked="Notification"
                        onclick="websocket.send('Notification=' + this.checked)" />
                </div>
                <div class="form-check form-switch">
                    <label class="form-check-label" for="NotificationGroup">NotificationGroup</label>
                    <input class="form-check-input" type="checkbox" id="NotificationGroup"
                        x-bind:checked="NotificationGroup"
                        onclick="websocket.send('NotificationGroup=' + this.checked)" />
                </div>
            </div>
            <div class="container border rounded my-3" onclick="websocket.send('SavePref')"
                x-data="{dataNotSaved:false}">
                <div x-show="dataNotSaved">
                    <button class="btn btn-outline-warning" @click="dataNotSaved=false">
                        SavePref
                    </button>
                </div>
                <div class="form-check form-switch">
                    <label class="form-check-label" for="AlertChecked">Alert</label>
                    <input class="form-check-input" type="checkbox" id="AlertChecked" %AlertNivActif%
                        onclick="websocket.send('AlertNivActif=' + this.checked)" />
                    <button type="button" class="btn btn-secondary btn-sm" onclick="websocket.send('testNotif')">
                        Test
                    </button>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="websocket.send('testNotifGroup')">
                        TestGroup
                    </button>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">Alert Min</span>
                    <input type="number" class="form-control param" name="AlertMin" id="AlertMin" value="%AlertNivMin%"
                        data-param="AlertNivMin" x-on:change="dataNotSaved = true" />
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">Alert Max</span>
                    <input type="number" class="form-control param" name="AlertMax" id="AlertMax" value="%AlertNivMax%"
                        data-param="AlertNivMax" />
                </div>
            </div>
        </div>
    </div>

    <div class="row py-2 mx-2" x-data="">
        <div class="col-sm">
            <div class="card mb-2">
                <div class="card-header">
                    <div class="d-flex">
                        <i class="bi bi-fan mx-2"></i> Turbine
                        <div class="ms-auto mx-2">
                            <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal"
                                data-bs-target="#TurbineModal">
                                <i class="bi bi-tools"></i>
                            </button>
                        </div>
                        <div class="ms-auto mx-2">
                            <i class="bi bi-circle-fill" style="color: grey"></i>
                        </div>
                        <div class="ms-auto" x-show="$store.Turbine.Error()">
                            <i class="bi bi-exclamation-triangle mx-2" style="color: red"></i>
                        </div>
                        <div class="form-check form-switch mx-2">
                            <input class="form-check-input" type="checkbox" role="switch" id="TurbineActive"
                                x-bind:checked="$store.Turbine.status.Active"
                                onclick="websocket.send('Turbine.Active=' + (this.checked?1:0))" />
                        </div>
                    </div>
                </div>
                <div class="card-body" id="Turbine">
                    <p class="text-muted">
                        RSSI:
                        <span id="TurbineRSSI" x-text="$store.Turbine.status.RSSI"></span>
                        dBm - SNR:
                        <span id="TurbineSNR" x-text="$store.Turbine.status.SNR"></span>
                        dB
                    </p>
                    <p>
                        Dernière MAJ:
                        <span class="nodeTimer" id="TurbineDernierMessage"
                            x-text="$store.Turbine.status.DernierMessage">-1</span>
                        s
                    </p>
                    <p>
                        position Vanne
                        <span id="positionVanne" x-text="$store.Turbine.positionVanne">%positionVanne%
                        </span>
                        %%
                    </p>
                    <p>
                        tacky:
                        <strong><span id="tacky" x-text="$store.Turbine.tacky">%tacky% </span>
                            rpm</strong>
                    </p>
                    <p>
                        Tension:
                        <span id="tension" x-text="$store.Turbine.tension">%tension%
                        </span>
                        V
                    </p>
                    <p>
                        Intensite:
                        <span id="intensite" x-text="$store.Turbine.intensite">%intensite%
                        </span>
                        A
                    </p>
                    <p>
                        Puissance:
                        <span id="power" x-text="$store.Turbine.power">%power% </span> W
                    </p>
                    <p>
                        Tension Batterie
                        <span id="tensionBatterie" x-text="$store.Turbine.tensionBatterie">%tensionBatterie%
                        </span>
                        V
                    </p>

                    <p>motorState <span x-text="$store.Turbine.motorState"></span> <span id="motorStateStr"
                            x-text="$store.Turbine.motorStateStr">%motorStateStr%</p>
                    <div class="btn-group" role="group" aria-label="Basic example">
                        <button type="button" class="btn btn-secondary computed" data-node="TURBINE" data-action="FT">
                            Fermeture Totale
                        </button>
                        <!-- <button type="button" class="btn btn-secondary">Middle</button> -->
                        <button type="button" class="btn btn-secondary computed" data-node="TURBINE" data-action="OT">
                            Ouverture Totale
                        </button>
                    </div>
                    <div class="btn-group" role="group" aria-label="Sommeil">
                        <button class="computed btn btn-secondary" data-node="TURBINE" data-action="LightSleep">
                            LightSleep
                        </button>
                        <button class="computed btn btn-secondary" data-node="TURBINE" data-action="DeepSleep">
                            DeepSleep
                        </button>
                        <button type="button" class="btn btn-outline-warning computed" data-node="TURBINE"
                            data-action="Reboot">
                            Reboot
                        </button>
                    </div>
                    <div class="btn-group btn-group-sm" role="group" aria-label="Zero Tension">
                        <button class="computed btn btn-secondary" data-node="TURBINE" data-action="ZV">
                            Zero Tension
                        </button>
                    </div>
                    <div class="btn-group btn-group-sm" role="group" aria-label="Zero Current">
                        <button class="computed btn btn-secondary" data-node="TURBINE" data-action="ZC">
                            Zero Courant
                        </button>
                    </div>
                    <div class="btn-group" role="group" aria-label="Calibration ADS">
                        <button class="computed btn btn-secondary" data-node="TURBINE" data-action="calibrate">
                            Calibration ADS
                        </button>
                    </div>
                    <div class="btn-group btn-group-sm" role="group" aria-label="Int max moteur">
                        <button class="computed btn btn-secondary" data-node="TURBINE" data-action="IMM">
                            Int max moteur
                        </button>
                    </div>
                    <div class="btn-group btn-group-sm" role="group" aria-label="turbine Max Speed">
                        <button class="computed btn btn-secondary" data-node="TURBINE" data-action="MaxSpeed">
                            Turbine Max Speed
                        </button>
                    </div>

                    <div class="btn-group" role="group" aria-label="">
                        <button class="computed btn btn-secondary" data-node="TURBINE" data-action="SavePref">
                            SavePref
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm">
            <div class="card mb-2" id="Etang" x-data="">
                <div class="card-header">
                    <div class="d-flex">
                        <i class="bi bi-moisture"></i>
                        <i class="bi bi-droplet-half mx-2"></i>
                        Etang
                        <div class="ms-auto mx-2">
                            <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal"
                                data-bs-target="#EtangModal">
                                <i class="bi bi-tools"></i>
                            </button>
                        </div>
                        <div class="ms-auto mx-2">
                            <i class="bi bi-circle-fill" style="color: grey"></i>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" role="switch" id="EtangActive"
                                x-bind:checked="$store.Etang.status.Active"
                                onclick="websocket.send('Etang.Active=' + (this.checked?1:0))" />
                            <label class="form-check-label" for="flexSwitchCheckDefault" hidden>Default switch checkbox
                                input</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <p class="text-muted" data-bs-toggle="tooltip" data-bs-placement="top"
                        title="Recorded Signal Strength Indicator in dBm">
                        Etang RSSI:
                        <span id="EtangRSSI" x-text="$store.Etang.status.RSSI"></span> dBm
                        - Etang SNR:
                        <span id="EtangSNR" x-text="$store.Etang.status.SNR"></span> dB
                    </p>
                    <p>
                        Dernière MAJ:
                        <span class="nodeTimer" id="EtangDernierMessage"
                            x-text="$store.Etang.status.DernierMessage">-1</span>
                        s
                    </p>
                    <div class="progress" role="progressbar" aria-label="Example with label">
                        <div class="progress-bar" :style="{width: $store.Etang.ratioNiveauEtangToString()}"
                            x-text="$store.Etang.ratioNiveauEtangToString()"></div>
                    </div>
                    <p>Niveau Etang: <span id="niveauEtang" x-text="$store.Etang.niveauEtang">%niveauEtang%</span> mm</p>
                    <p>
                        Niveau Etang:
                        <strong><span id="ratioNiveauEtang" x-text="$store.Etang.ratioNiveauEtang">%ratioNiveauEtang%
                            </span>%%</strong>
                    </p>
                    <p>Vl53 Status <span  x-text="$store.Etang.vl53Status"></span></p>
                    <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">
                        <button type="button" class="btn btn-secondary computed" data-node="ETANG"
                            data-action="setNiveauFull">
                            Set Niveau full
                        </button>
                        <button type="button" class="btn btn-secondary computed" data-node="ETANG"
                            data-action="setNiveauTP">
                            Set Niveau TP
                        </button>
                        <button type="button" class="btn btn-secondary computed" data-node="ETANG"
                            data-action="setNiveauEmpty">
                            Set Niveau empty
                        </button>
                    </div>

                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-secondary computed" data-node="ETANG"
                            data-action="LedVL53">
                            Led VL53
                        </button>
                        <button type="button" class="btn btn-secondary computed" data-node="ETANG"
                            data-action="savePref">
                            Save Pref
                        </button>
                        <button type="button" class="btn btn-outline-warning computed" data-node="ETANG"
                            data-action="Reboot">
                            <i class="bi bi-bootstrap-reboot"></i> Reboot
                        </button>
                    </div>
                    <div x-data="{ edit: false, full : 0,vide : 0}">
                        <button class="btn btn-outline-secondary" @click="edit = !edit" @click.outside="edit = false">
                            Edit
                        </button>
                        <label for="niveauRempli" class="form-label">niveauRempli <span
                                x-text="$store.Etang.niveauRempli"></span>
                            <span x-show="edit" x-text="full"></span></label>
                        <input type="range" class="form-range computed-range" name="" x-bind:disabled="!edit"
                            id="niveauRempli" max="1000" @click="console.log($event)"
                            x-on:input="full = $event.target.value" x-on:change=" $store.Etang.sendRempli($event)"
                            x-bind:value="$store.Etang.niveauRempli" />
                        <label for="niveauVide" class="form-label">niveauVide <span
                                x-text="$store.Etang.niveauVide"></span><span x-show="edit"
                                x-text="vide"></span></label>
                        <input type="range" class="form-range computed-range" name="" x-bind:disabled="!edit"
                            id="niveauVide" min="1500" max="3000" @click="console.log($event)"
                            x-on:input="vide = $event.target.value" x-on:change=" $store.Etang.sendVide($event)"
                            x-bind:value="$store.Etang.niveauVide" />
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm">
            <div class="card mb-2" id="Radiateurs">
                <div class="card-header">
                    <div class="d-flex">
                        Test
                        <div class="ms-auto">
                            <i class="bi bi-circle-fill" style="color: grey"></i>
                        </div>
                        <div class="ms-auto mx-2">
                            <button class="btn btn-outline-secondary btn-sm" onclick="console.log('bjr');">
                                <i class="bi bi-tools"></i>
                            </button>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" role="switch" id="RadiateursActive"
                                x-bind:checked="$store.Radiateurs.status.Active"
                                onclick="websocket.send('Radiateurs.Active=' + (this.checked?1:0))" />
                            <label class="form-check-label" for="flexSwitchCheckDefault" hidden>Default switch checkbox
                                input</label>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <p class="text-muted">
                        RSSI:
                        <span id="RadiateursRSSI" x-text="$store.Radiateurs.status.RSSI"></span>
                        dBm - SNR:
                        <span id="RadiateursSNR" x-text="$store.Radiateurs.status.SNR"></span>
                        dB
                    </p>
                    <p>
                        Dernière MAJ:
                        <span class="nodeTimer" id="RadiateursDernierMessage"
                            x-text="$store.Radiateurs.status.DernierMessage">-1</span>
                        s
                    </p>
                    <p>
                        temp
                        <span id="temp" x-text="$store.Radiateurs.temp">%temp% </span> °C
                    </p>

                    <button type="button" class="btn btn-secondary computed" data-node="NODETEST" data-action="blink">
                        Blink
                    </button>
                    <button type="button" class="btn btn-secondary computed" data-node="NODETEST"
                        data-action="DEEPSLEEP">
                        DEEPSLEEP
                    </button>
                    <button type="button" class="btn btn-secondary computed" data-node="NODETEST"
                        data-action="ToggleScreen">
                        ToggleScreen
                    </button>
                    <button type="button" class="btn btn-secondary computed" data-node="NODETEST"
                        data-action="ScanWifi">
                        ScanWifi
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="container border mb-2">
        <div id="chartNiveau" class="container highcharts-auto"></div>
    </div>
    <div class="container border mb-2">
        <div id="chartTurbine" class="container highcharts-auto"></div>
    </div>
    <div class="container" x-data="">
        <h3>Energie</h3>
        <span x-text="$store.Data.Energie"></span>
        <button class="btn btn-outline-secondary" onclick="websocket.send('resetEnergieMeter')">Reset</button>
    </div>
    <div class="container mb-2">
        <div class="accordion" id="accordionExample">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                        <i class="bi bi-terminal-x"></i>
                        Terminal
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div id="terminal"></div>
                        <form id="command-form">
                            <label for="command-input">&gt;&nbsp;</label>
                            <input class="form-control" type="text" id="command-input" autocomplete="off" />
                            <button class="btn btn-outline-light" type="submit">
                                Envoyer
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingSecond">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseSecond" aria-expanded="false" aria-controls="collapseSecond">
                        Setting
                    </button>
                </h2>
                <div id="collapseSecond" class="accordion-collapse collapse" aria-labelledby="headingSecond"
                    data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <button type="button" class="btn btn-outline-success" onclick="websocket.send('SavePref')">
                            SavePref
                        </button>
                        <button type="button" class="btn btn-outline-success" onclick="websocket.send('LedNotif')">
                            LedNotif
                        </button>
                        <button type="button" class="btn btn-outline-warning"
                            onclick="websocket.send('DeepSleepServer')">
                            DeepSleepServer
                        </button>
                        <button type="button" class="btn btn-outline-warning" onclick="websocket.send('SpectrumScan')">
                            SpectrumScan
                        </button>
                        <button type="button" class="btn btn-outline-danger"
                            onclick="window.dispatchEvent(new Event('beforeunload'))">
                            beforeunload
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div aria-live="polite" aria-atomic="true" class="">
        <div class="toast-container position-fixed p-3 top-0 end-0" id="toastContainer"></div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalDisconnected" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Serveur Eteind</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">... :'(</div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Close
                    </button>
                    <button type="button" onclick="initWebSocket()" class="btn btn-primary">
                        Tenter reconnexion
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- modal Turbine -->
    <div class="modal fade" id="TurbineModal" tabindex="-1" aria-labelledby="turbineModalLabel" aria-hidden="true"
        x-data="">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="turbineModalLabel">Turbine</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="btn-group btn-group-sm" role="group" aria-label="turbine Max Speed">
                        <button class="computed btn btn-secondary" data-node="TURBINE" data-action="CpuFreq">
                            Cpu Freq
                        </button>
                        <button class="computed btn btn-danger" data-node="TURBINE" data-action="idle">
                            idle
                        </button>
                        <button class="computed btn btn-secondary" data-node="TURBINE" data-action="tackyDebounce">
                            tackyDebounceTime
                        </button>
                    </div>

                    <div x-data="{selected:%CpuFreq%,CpuFreqs:[240,160,80,40,20,10]}">
                        <select class="form-select form-select-sm computed-range" name="Turbine_CpuFreq"
                            data-node="TURBINE" data-action="CpuFreq">
                            <template x-for="CpuFreq in CpuFreqs" :key="CpuFreq">
                                <option :value="CpuFreq" :selected="selected == CpuFreq" x-text="CpuFreq + ' MHz'">
                                </option>
                            </template>
                        </select>
                    </div>
                </div>
                <div class="" x-data="">
                    <div class="input-group mb-3">
                        <span class="input-group-text" id="basic-addon1">AC</span>
                        <input type="text" class="form-control" placeholder="AC" x-bind:value="$store.Turbine.AC"
                            on:change="$store.Turbine.changeParamADS('AC',$event.target.value)" />
                    </div>
                    <div class="input-group mb-3">
                        <span class="input-group-text" id="basic-addon1">ZC</span>
                        <input type="text" class="form-control" placeholder="ZC" x-bind:value="$store.Turbine.ZC"
                            on:change="$store.Turbine.changeParamADS('ZC',$event.target.value)" />
                    </div>
                    <div class="input-group mb-3">
                        <span class="input-group-text" id="basic-addon1">AV</span>
                        <input type="text" class="form-control" placeholder="AV" x-bind:value="$store.Turbine.AV"
                            on:change="$store.Turbine.changeParamADS('AV',$event.target.value)" />
                    </div>
                    <div class="input-group mb-3">
                        <span class="input-group-text" id="basic-addon1">ZV</span>
                        <input type="text" class="form-control" placeholder="ZV" x-bind:value="$store.Turbine.ZV"
                            on:change="$store.Turbine.changeParamADS('ZV',$event.target.value)" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Close
                    </button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- modal Etang -->
    <div class="modal fade" id="EtangModal" tabindex="-1" aria-labelledby="etangModalLabel" aria-hidden="true"
        x-data="">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="turbineModalLabel">Etang</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                        x-data=""></button>
                </div>
                <div class="modal-body">
                    <div class="input-group input-group-sm" x-data="{RoiXYValue:[16,8,6,4]}">
                        <span class="input-group-text">RoiXY </span>
                            <template x-for="item in RoiXYValue">
                                <button type="button" class="btn" :class="$store.Etang.RoiX != item ? 'btn-outline-secondary' :  'btn-secondary'"
                                x-text="RoiXY= item"> </button>
                            </template>
                    </div>
                    <div class="input-group input-group-sm">
                        <span class="input-group-text">Timing Budget (ms) </span>
                        <template x-for="tb in $store.Etang.timingBudgets">
                            <button class="btn"
                            :class="$store.Etang.timingBudget != tb ? 'btn-outline-secondary' :  'btn-secondary'"
                            type="button"  x-text="tb" @click="$store.Etang.sendTB(tb)">
                        </button>
                        </template>
                    </div>

                    <div class="input-group input-group-sm" x-data="{dm:[{id:1,name:'Short'},{id:2,name:'Long'},]}">
                        <span class="input-group-text">distanceMode :
                            <span id="distanceMode" x-text="$store.Etang.distanceMode"></span></span>

                        <template x-for="item in dm">
                            <button class="btn"
                            :class="$store.Etang.distanceMode != item.id ? 'btn-outline-secondary' :  'btn-secondary'"
                            type="button" x-text="item.name" @click="$store.Etang.sendDM(item.id)"></button>
                        </template>

                    </div>
                    <div class="btn-group" role="group"></div>
                    <div class="container">
                        <p>
                            RoiC :
                            <span id="RoiCenter" x-text="$store.Etang.RoiCenter"></span>
                        </p>
                        <table class="table table-bordered"  id="spad">
                            <thead>
                            </thead>
                            <tbody>
                                <template x-for="ligne in $store.Etang.spad" >
                                    <tr>
                                        <template x-for="el in ligne" :key="el">
                                            <td  @click="$store.Etang.sendRoiC(el)" :class="el == $store.Etang.RoiCenter ? 'table-primary' : ''" ></td>
                                        </template>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                        
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Close
                    </button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
            <div class="col-md-4 d-flex align-items-center">
                <a href="/" class="mb-3 me-2 mb-md-0 text-body-secondary text-decoration-none lh-1">
                    <svg class="bi" width="30" height="24">
                        <use xlink:href="#bootstrap"></use>
                    </svg>
                </a>
                <span class="mb-3 mb-md-0 text-body-secondary">© 1922 HydroBabiat, Inc</span>
            </div>
            <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
                <li class="ms-3">
                    <a class="text-body-secondary" href="https://github.com/Baptou88/HydroBabiat/issues"><i class="bi bi-bug"></i></a>
                </li>
                <li class="ms-3">
                    <a class="text-body-secondary" href="https://github.com/Baptou88/HydroBabiat"><i class="bi bi-github"></i></a>
                </li>
                <li class="ms-3">
                    <a class="text-body-secondary" href="https://www.instagram.com/baptou88/"><i class="bi bi-instagram"></i></a>
                </li>
            </ul>
        </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>   
    <script>
        function updateNodeTimer() {
            var nodes = document.querySelectorAll(".nodeTimer");

            nodes.forEach((el) => {
                var it = parseInt(el.innerHTML);
                if (it != -1) {
                    it = it + 2;
                    el.innerHTML = it;
                    var color;
                    if (it <= -1) {
                        color = "grey";
                    } else if (it <= 30) {
                        color = "green";
                    } else if (it <= 120) {
                        color = "orange";
                    } else {
                        color = "red";
                    }
                    var test = el.parentElement.parentElement.parentElement;
                    var test2 = test.querySelector(".bi-circle-fill");
                    test2.style.color = color;
                }
            });
        }
        var nodeTimerIntervall = window.setInterval(function () {
            updateNodeTimer(2000);
        }, 2000);
    </script>
</body>

</html>