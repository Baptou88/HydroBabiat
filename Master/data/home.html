<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HydroBabiat</title>
    <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-dark-5@1.1.3/dist/css/bootstrap-nightshade.min.css" rel="stylesheet">
    <script defer src="https://unpkg.com/alpinejs@3.10.5/dist/cdn.min.js"></script>


    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/stock/modules/export-data.js"></script>

    <script src="/app.js" type="text/javascript"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-light">
       
              
       
        <div class="container-fluid">
            
            <a class="navbar-brand" href="#">
                <img src="/icons/hydro-elec-512.svg" alt="Bootstrap" width="30" height="30">
                HydroBabiat
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Dropdown
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">Action</a></li>
                        <li><a class="dropdown-item" href="#">Another action</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#">Something else here</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled">Disabled</a>
                </li>
                <li class="nav-item">
                    <input type="button" id="darkmode" class="btn btn-primary" value="darkmode">
                </li>
                </ul>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>
            </div>
        </div>
    </nav>


    
    
    <div class="row mx-1 mt-2">
        <div class="col-4">
            <div class="card">
                <div class="card-header">Modes
                    <div class="card-subtitle">%mode%</div>
                </div>
                
                <ul class="list-group" id="modes">%modes%</ul>
            </div>
        </div>

        <div class="col-8" >
            <div class="container border rounded" data-modee="0">m0
                
                <label for="RangePosVanneTarget" class="form-label">Cible Vanne</label>
                <input type="range" class="form-range" id="RangePosVanneTarget" value="%RangePosVanneTarget%">
            </div>
            <div class="container  border rounded" data-modee="1">m1
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">min</span>
                    <input type="number" class="form-control" name="bcmin" id="bc.min" value="%bc.min%" data-param="bc.min">
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">max</span>
                    <input type="number" class="form-control" name="bcmax" id="bc.max" value="%bc.max%" data-param="bc.max">
                </div>
            </div>
            <div class="container border rounded" data-modee="2">m2
                <div class="input-group mb-3" >
                    <span class="input-group-text" id="basic-addon1">kp</span>
                    <input type="number" class="form-control param" name="pidcKp" id="pidcKp" value="%pidc.kp%" data-param="pidc.kp">
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">ki</span>
                    <input type="number" class="form-control" name="pidcKi" id="pidcKi" value="%pidc.ki%" data-param="pidc.ki">
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">kd</span>
                    <input type="number" class="form-control" name="pidcKd" id="pidcKd" value="%pidc.kd%" data-param="pidc.kd">
                </div>
                <div class="input-group mb3">
                    <input type="button"  class="btn param" value="a">
                </div>
            </div>

            <div class="container border rounded mb-3">
                
                <div class="form-check form-switch">
                    <label class="form-check-label" for="flexSwitchCheckDefault">Alert</label>
                    <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">Alert Min</span>
                    <input type="number" class="form-control" name="AlertMin" id="AlertMin" value="20" data-param="alertMin">
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">Alert Max</span>
                    <input type="number" class="form-control" name="AlertMax" id="AlertMax" value="100" data-param="alertMax">
                </div>
            </div>

        </div>
    </div>
    
    <div class="card mt-2 mx-2">
        <div class="card-header">
            Turbine
        </div>
        <div class="card-body">
            <p>Turbine RSSI: <span id="TurbineRSSI"></span> dBm</p>
            <p>Turbine SNR: <span id="TurbineSNR"></span> dB</p>
            <p>Dernière MAJ: <span class="nodeTimer" id="TurbineDernierMessage">-1</span> s</p>
            <p>position Vanne <span id="positionVanne">%positionVanne% </span> %%</p>
            <p>tacky <span id="tacky">%tacky% </span> rpm</p>
            <p>Tension <span id="tension">%tension% </span> V</p>
            <p>Tension Batterie <span id="tensionBatterie">%tensionBatterie% </span> V</p>
            <p>motorState <span id="motorState">%motorState% </span> V</p>
            
            <div class="btn-group" role="group" aria-label="Basic example">
                <button type="button" class="btn btn-secondary">Fermeture Totale</button>
                <!-- <button type="button" class="btn btn-secondary">Middle</button> -->
                <button type="button" class="btn btn-secondary">Ouverture Totale</button>
            </div>
            <div class="btn-group" role="group" aria-label="Sommeil">
                <button class="computed btn btn-secondary" data-node="TURBINE" data-action="DeepSleep">DeepSleep</button>
            </div>

        </div>
    </div>
    <div class="card mt-2 mx-2">
        <div class="card-header">
            Etang
        </div>
        <div class="card-body">
            <p data-bs-toggle="tooltip" data-bs-placement="top" title="Recorded Signal Strength Indicator in dBm">Etang RSSI: <span id="EtangRSSI"></span> dBm</p>
            <p>Etang SNR: <span id="EtangSNR"></span> dB</p>
            <p>Dernière MAJ: <span class="nodeTimer" id="EtangDernierMessage">-1</span> s</p>
            <p>Niveau Etang: <span id="niveauEtang">%niveauEtang% </span> </p>
            <p>Niveau Etang: <span id="ratioNiveauEtang">%ratioNiveauEtang% </span> %%</p>
            
            <div class="btn-group" role="group" aria-label="Basic example">
                <button type="button" class="btn btn-secondary computed" data-node="ETANG" data-action="setNiveauFull" >Set Niveau full</button>
                <button type="button" class="btn btn-secondary computed" data-node="ETANG" data-action="setNiveauTP">Set Niveau TP</button>
                <button type="button" class="btn btn-secondary computed" data-node="ETANG" data-action="setNiveauEmpty">Set Niveau empty</button>
            </div>
            <button type="button" class="btn btn-secondary computed" data-node="ETANG" data-action="savePref">Save Pref</button>
        </div>
    </div>
    <div class="container border mb-2">
        <div id="chartNiveau" class="container"></div>
    </div>
    <div class="container border mb-2">
        <div id="chartTurbine" class="container"></div>
    </div>
    <div class="container">
        <h3>Temps d'envoi</h3>
        <input type="number" name="TempsEnvoi" id="TempsEnvoi" value="10">
    </div>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script> -->
    <script>
        document.querySelector("#darkmode").onclick = function(e){
          darkmode.toggleDarkMode();
        }
        function updateNodeTimer() {
            var nodes = document.querySelectorAll('.nodeTimer');
            //console.log("nodes",nodes);
            nodes.forEach(el => {
                var it = parseInt(el.innerHTML)
                if (it != -1) {
                    el.innerHTML = it+2
                }
            })
        }
        var nodeTimerIntervall = window.setInterval(function(){
            updateNodeTimer(2000)
        }, 2000);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-dark-5@1.1.3/dist/js/darkmode.min.js"></script>

    
</body>
</html>